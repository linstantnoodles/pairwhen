{% extends 'base.html' %}
{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/datepicker.css') }}">
  <style type="text/css">
    #date-picker-container {
      display: flex;
      flex-direction: row;
      width: 500px;
      justify-content: space-between;
    }

    #id-textbox-1{
      display: none;
    }

    #times {
      width: 150px;
    }

    .u--hide {
      display: none;
    }

    .calendar-form {
      display: flex;
      flex-direction: column;
      width: 50%;
    }

    .time-list {
      transform: translateX(-20%);
      -webkit-transform: translateX(-20%);
      height: 350px;
      overflow: scroll;
    }

    .slide-in {
        animation: slide-in 0.5s forwards;
        -webkit-animation: slide-in 0.5s forwards;
    }

    @keyframes slide-in {
      100% { transform: translateX(0%); }
    }
    @-webkit-keyframes slide-in {
        100% { -webkit-transform: translateX(0%); }
    }

    .slide-out {
      animation: slide-out 0.5s forwards;
      -webkit-animation: slide-out 0.5s forwards;
    }

    @keyframes slide-out {
        100% { transform: translateX(0%); }
    }

    @-webkit-keyframes slide-out {
        100% { -webkit-transform: translateX(0%); }
    }

    @keyframes slide-out {
        0% { transform: translateX(0%); }
        100% { transform: translateX(-100%); }
    }

    @-webkit-keyframes slide-out {
        0% { -webkit-transform: translateX(0%); }
        100% { -webkit-transform: translateX(-100%); }
    }

    ::-webkit-scrollbar {
  -webkit-appearance: none;
  width: 7px;
}

::-webkit-scrollbar-thumb {
  border-radius: 4px;
  background-color: rgba(0, 0, 0, .5);
  box-shadow: 0 0 1px rgba(255, 255, 255, .5);
}
  </style>
{% endblock %}

{% block content %}
<div class="calendar">
  <h1>Alan's Calendar Availability</h1>
  <p>Duration: 30 MIN</p>
  <p class="tz-info-invite">(All times are displayed in your timezone: <span id="timezone"></span>)</p>
  <div id="date-picker-container">
    <div id="myDatepicker" class="datepicker">
                <!-- <button class="icon" aria-label="Choose Date">
          <span class="fa fa-calendar-alt fa-2x"></span>
        </button> -->
      <div id="id-datepicker-1"
           class="datepickerDialog"
           role="dialog"
           aria-modal="true"
           aria-labelledby="id-dialog-label">
        <div class="header">
          <button class="prevYear" aria-label="previous year">
            <span class="fas fa-angle-double-left fa-lg"></span>
          </button>
          <button class="prevMonth" aria-label="previous month">
            <span class="fas fa-angle-left fa-lg">Prev</span>
          </button>
          <h2 id="id-dialog-label"
              class="monthYear"
              aria-live="polite">
            Month Year
          </h2>
          <button class="nextMonth" aria-label="next month">
            <span class="fas fa-angle-right fa-lg">Next</span>
          </button>
          <button class="nextYear" aria-label="next year">
            <span class="fas fa-angle-double-right fa-lg"></span>
          </button>
        </div>
        <table id="myDatepickerGrid"
               class="dates"
               role="grid"
               aria-labelledby="id-dialog-label">
          <thead>
            <tr>
              <th scope="col" abbr="Sunday">
                Su
              </th>
              <th scope="col" abbr="Monday">
                Mo
              </th>
              <th scope="col" abbr="Tuesday">
                Tu
              </th>
              <th scope="col" abbr="Wednesday">
                We
              </th>
              <th scope="col" abbr="Thursday">
                Th
              </th>
              <th scope="col" abbr="Friday">
                Fr
              </th>
              <th scope="col" abbr="Saturday">
                Sa
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  25
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  26
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  27
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  28
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  29
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  30
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  1
                </button>
              </td>
            </tr>
            <tr>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  2
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  3
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  4
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  5
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  6
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  7
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  8
                </button>
              </td>
            </tr>
            <tr>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  9
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  10
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  11
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  12
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  13
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="0">
                  14
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  15
                </button>
              </td>
            </tr>
            <tr>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  16
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  17
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  18
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  19
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  20
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  21
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  22
                </button>
              </td>
            </tr>
            <tr>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  23
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  24
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  25
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  26
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  27
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  28
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  29
                </button>
              </td>
            </tr>
            <tr>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  30
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton" tabindex="-1">
                  31
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  1
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  2
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  3
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  4
                </button>
              </td>
              <td class="dateCell">
                <button class="dateButton"
                        tabindex="-1"
                        disabled="">
                  5
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <!-- <div class="dialogButtonGroup">
          <button class="dialogButton" value="cancel">
            Cancel
          </button>
          <button class="dialogButton" value="ok">
            OK
          </button>
        </div>
        <div class="message" aria-live="polite">
        </div>-->
      </div>
    </div>
      <div id="times">
        {% for key, value in availability.items() %}
        <ol id="curr-times" class="u--hide time-list {{ key }}">
          {% for time in value %}
            <li>
              <div>
              <span class="time-range-available">{{ time }}</span>
              </div>
              <input type="radio" value="{{ time }}" name="available_time">
            </li>
          {% endfor %}
        </ol>
        {% endfor %}
      </div>
    </div>
    <form id="form" action="/calendar/linalan" method="POST">
      <input type="hidden" name="timezone" id="timezone_value"/>
      <input type="hidden" name="time" id="time_value"/>
      <input type="text" placeholder="mm/dd/yyyy" name="date" id="id-textbox-1">
      <div class="calendar-form">
          <label for="email">Email</label>
          <input id="email" type="email" name="email" required/>
          <label for="name">Name (optional)</label>
          <input id="name" type="text" name="name"/>
          <label for="message">Message (optional)</label>
          <textarea id="message" type="text" name="message" placeholder="See ya!"></textarea>
      </div>
      <button type="submit">Submit</button>
    </form>
    <br>
    {% block scripts %}
      <script type="text/javascript" src="{{ url_for('static', filename='js/moment-min.js') }}"></script>
      <script type="text/javascript" src="{{ url_for('static', filename='js/moment-timezone.js') }}"></script>
      <script type="text/javascript" src="{{ url_for('static', filename='js/datepicker.js') }}"></script>
      <script type="text/javascript" src="{{ url_for('static', filename='js/calendar-button.js') }}"></script>
      <script type="text/javascript" src="{{ url_for('static', filename='js/datepicker-day.js') }}"></script>
      <script type="text/javascript">
          const timezone = moment.tz.guess();
        let tzElement = document.getElementById("timezone");
        let tzValueElement = document.getElementById("timezone_value"); // send to server
        tzElement.innerHTML = timezone;
        tzValueElement.value = timezone;

        let times = document.getElementById("times");
        let timeInput = document.getElementById("time_value");
        times.addEventListener("click", (event) => {
          let element = event.target;
          if (element.tagName == 'INPUT') {
            timeInput.value = element.value;
          }
        });

        window.addEventListener('load' , function () {
          let myWeekMap = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
          let currWeekday = null;
          var datePickers = document.querySelectorAll('.datepicker');
          datePickers.forEach(function (dp) {
            var inputNode   = document.getElementById('id-textbox-1');
            var buttonNode  = dp.querySelector('button');
            var dialogNode  = dp.querySelector('[role=dialog]');
            var datePicker = new DatePicker(inputNode, buttonNode, dialogNode);
            datePicker.init((pickedDate) => {
              let value = pickedDate.getAttribute("data-date");
              let parts = value.split('-');
              let mydate = new Date(parts[0], parts[1] - 1, parts[2]);
              let day = mydate.getDay();
              if (currWeekday) {
                currWeekday.classList.add("u--hide");
                currWeekday.classList.remove("slide-in");
                // Force reflow so that we can repeat the animation if double clicked on same weekday
                void currWeekday.offsetWidth;
              }
              let elements = document.getElementsByClassName(myWeekMap[day]);
              elements[0].classList.remove("u--hide");
              elements[0].classList.add("slide-in");
              currWeekday = elements[0];
            });
          });
        });
      </script>
    {% endblock %}
</div>
{% endblock %}